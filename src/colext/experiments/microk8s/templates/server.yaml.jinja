apiVersion: v1
kind: Pod
metadata:
  name: fl-server
  labels:
    colext-dev-type: server
    colext-job-id: "{{ job_id }}"
spec:
  containers:
  - name: fl-server
    image: {{ image }}
    command: ["bash", "-c"]
    args: ["python3 {{ server_entrypoint }} {{ image_args }}"]
    env:
      - name: COLEXT_ENV
        value: "1"
      - name: COLEXT_JOB_ID
        value: "{{ job_id }}"
      - name: COLEXT_N_CLIENTS
        value: "{{ n_clients }}"
    ports:
      - containerPort: 8080
        name: flserver-port
    startupProbe:
      tcpSocket:
        port: flserver-port
      initialDelaySeconds: 5
      periodSeconds: 10
      failureThreshold: 2
  restartPolicy: Never
  imagePullSecrets:
  - name: regcred
  nodeSelector:
    kubernetes.io/hostname: kw61463
