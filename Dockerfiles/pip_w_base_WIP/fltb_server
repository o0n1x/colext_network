FROM python:3.8.10
# Python version matches version in jetson image

ARG USER_CODE_RELATIVE_PATH
RUN test -n "$USER_CODE_RELATIVE_PATH"

RUN python3 -m pip install --no-cache-dir psycopg[binary]

WORKDIR /fl_testbed
# Add fltb src to pythonpath
ENV PYTHONPATH "`pwd`/fltb:"

COPY ./src/fltb ./fltb
COPY ./../user_code_example_test ./user_code
RUN python3 -m pip install -r ./user_code/requirements.txt

ENTRYPOINT ["python3"]