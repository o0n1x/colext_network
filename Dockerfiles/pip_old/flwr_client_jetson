FROM nvcr.io/nvidia/l4t-pytorch:r35.2.1-pth2.0-py3
# Comes with Python 3.8.10

RUN python3 -m pip install --no-cache-dir --upgrade pip setuptools
RUN python3 -m pip install --no-cache-dir flwr tqdm psutil

# Bake the CIFAR-10 dataset in the image
# RUN python3 -c "from torchvision.datasets import CIFAR10; CIFAR10('./data', download=True)"
# To make it faster for now, data is copied from the server to inside the image 

# Install extra deps
RUN python3 -m pip install --no-cache-dir psycopg[binary] jetson-stats


WORKDIR /fl_testbed
ENV PYTHONPATH "${PYTHONPATH}:/fl_testbed/src"

COPY ./src .
COPY ./user_code_example .
COPY ./data .
CMD ["python3", "./user_code_example/client.py"]